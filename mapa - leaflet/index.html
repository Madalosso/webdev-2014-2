
<!DOCTYPE html>
<html>
<head>
	<title>WEB Dev 2014/2</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyB9owNUTqrxUPa4RaV0ycQYrAslGWSMPbo&sensor=false"></script>
	<script src="main.js" type="text/javascript"></script>
	<script>
		var map,dialog;
		var markTemp,markOrigem,markDestino;
		var posTemp;
		var geocoder;
		var directionsService = new google.maps.DirectionsService();
		var directionsDisplay = new google.maps.DirectionsRenderer();
		function initialize()
		{
			geocoder = new google.maps.Geocoder();
			var posHouse = new google.maps.LatLng(-29.706822, -53.720390);
			var mapProp = {
			  center:new google.maps.LatLng(-29.706822, -53.720390),
			  zoom:16,
			  mapTypeId:google.maps.MapTypeId.ROADMAP
			  };
			map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
			google.maps.event.addListener(map, 'click', function(event) {
			    addDialog(event.latLng);
			  });

			  dialog = new google.maps.InfoWindow({
			    content:"<button id='btSource' onClick='setOrigem()'>Set Origin</button><button id='btDestino' onClick='setDestino()'>Set Destiny</button>"
			  });
		}

		function setOrigem(){
			if(markOrigem==null){
				markOrigem= new google.maps.Marker({position:posTemp,});
			}else{
				markOrigem.setPosition(posTemp);
			}
			markOrigem.setMap(map);
			dialog.close();

			geocoder.geocode({'latLng':posTemp}, function(results, status){
				if(status == google.maps.GeocoderStatus.OK){
					if(results[1]){
						map.setZoom(16);
						console.log("Endereco origem: "+results[1]);
						console.log(results[1]);
					}
				}
			});
		}

		function setDestino(){
			if(markDestino==null){
				markDestino= new google.maps.Marker({position:posTemp,});
			}else{
				markDestino.setPosition(posTemp);
			}
			markDestino.setMap(map);
			dialog.close();


			geocoder.geocode({'latLng':posTemp}, function(results, status){
				if(status == google.maps.GeocoderStatus.OK){
					if(results[1]){
						map.setZoom(16);
						console.log("Endereco Destino: "+results[1]);
						console.log(results[1]);
					}
				}
			});
		}

		function addDialog(pos){
			console.log(pos);
			if(markTemp==null){
				markTemp= new google.maps.Marker({position:pos,});
			}else{
				markTemp.setPosition(pos);
			}
			dialog.open(map,markTemp);
			markTemp.setMap(map);
			posTemp = pos;
			console.log("position: "+posTemp);
		}

		function findRota(){
			var start =  markOrigem.getPosition();
			var end = markDestino.getPosition();
			directionsDisplay.setMap(map);
			var request={
				origin:start,
				destination:end,
				travelMode: google.maps.TravelMode.WALKING
			};
			directionsService.route(request, function(result, status) {
			    if (status == google.maps.DirectionsStatus.OK) {
			      directionsDisplay.setDirections(result);
			    }
	  		});
		}
		google.maps.event.addDomListener(window, 'load', initialize);
	</script>


</head>
<body>
	<div id="header">
	</div>

	<div id="menu-left">
		<br><br>
		<div id="formulario">
			<form>
				<br>
				<div class="formul"> Endereço Origem: <input type="text" id="endereco_start" name="origem"></div><br>
				<div class="formul"> Endereço Destino: <input type="text" id="endereco_finish" name="destino"></div><br>
			</form>
			<button id="btCalc" style="margin-left:130px" onClick="findRota()">Calcular rota</button>
		</div>
	</div>

	<div id="contain">
		<div id="googleMap" style="width:100%;height:100%;"></div>
	</div>


	<div id="footer">
	</div>

</body>
</html>